{% trans_default_domain 'products-stocks.admin' %}

{% set ROLE = 'ROLE_PRODUCT_STOCK' %}

{# ---- CSS ------------------------------------------------------------ #}
{% block title %}
    {{ 'page.pickup'|trans }}
{% endblock %}

{# ---- ШАБЛОН ------------------------------------------------------------ #}
{% extends Template('/admin/base.html.twig') %}

{# ---- CSS ------------------------------------------------------------ #}
{% block stylesheets %}
    <link href="/assets/plugins/nice-select2/nice-select2.min.css" rel="stylesheet" type="text/css">
    <link href="/assets/plugins/datepicker/datepicker.min.css" rel="stylesheet">
{% endblock %}


{# ---- КОНТЕНТ-БЛОК ------------------------------------------------------------ #}
{% block content %}
    {{ include(_self|replace({ "template.html.twig": baks_settings.device~"/content.html.twig" })) }}
{% endblock %}


{% block javascript %}
<script nonce='{{ csp_nonce() }}' async data-src="/assets/plugins/nice-select2/nice-select2.min.js?v={{ version }}" class="lazy"></script>
<script nonce='{{ csp_nonce() }}' async data-src="/assets/products_stocks/moving.min.js?v={{ version }}" class="lazy"></script>
<script nonce='{{ csp_nonce() }}' async data-src="/assets/plugins/datepicker/datepicker.min.js?v={{ version }}" class="lazy"></script>
<script nonce='{{ csp_nonce() }}' async data-src="/assets/js/print.min.js?v={{ version }}" class="lazy"></script>
<script nonce='{{ csp_nonce() }}' async data-src="/assets/js/radio.input.min.js?v={{ version }}" class="lazy"></script>
<script nonce='{{ csp_nonce() }}' async data-src="/assets/js/copy.min.js?v={{ version }}" class="lazy"></script>

 <script nonce="{{ csp_nonce() }}" class="lazy">
 window.centrifugo_dsn = "{{ centrifugo_dsn }}";
 window.centrifugo_token = "{{ token }}";
 </script>

<script nonce='{{ csp_nonce() }}' async data-src="/assets/centrifugo/centrifuge.min.js?v={{ version }}" class='lazy'></script>
<script nonce='{{ csp_nonce() }}' async data-src="/assets/centrifugo/socket.min.js?v={{ version }}" class='lazy'></script>


    <script nonce="{{ csp_nonce() }}">

        document.addEventListener("DOMContentLoaded", (event) =>
        {

            const form = document.forms.product_stock_pickup_filter_form;
            form.addEventListener('change', () => { setTimeout(() => { form.submit(); }, 300); });

            form.addEventListener('keydown', function(event)
            {
                if(event.key === "Enter")
                {
                    form.submit();
                }
            });

                let hZmBqNQQ = 100;

                setTimeout(function yZugPWYF()
                {
                    if(typeof centrifuge !== 'object')
                    {
                        if(hZmBqNQQ > 1000) { return; }

                        hZmBqNQQ = hZmBqNQQ * 2;
                        return setTimeout(yZugPWYF, hZmBqNQQ);
                    }

                    /** Удаляем из списка тикет у других */
                    centrifuge.newSubscription('remove').on('publication', function(ctx)
                    {

                        if(ctx.data.profile === '{{ current_profile }}')
                        {
                            return;
                        }

                        let $identifier = document.getElementById(ctx.data.identifier);

                        if($identifier)
                        {
                            $identifier.remove();
                        }

                    }).subscribe();

                }, 100);
        });

        function changeDatapicker(input)
        {
            let forms = input.closest('form');
            forms.submit();
        }

    </script>


<script nonce="{{ csp_nonce() }}">


/** Обработчики кнопок выбора товаров */
var select_all_to_completed = document.querySelector("#select-all-to-completed");
var add_all_to_completed = document.querySelector("#add-all-to-completed");

/** Выбор из списка */
select_all_to_completed?.addEventListener("click", function() {

    // Выбрать все
    select_all_to_completed.classList.toggle("selected");


    if(select_all_to_completed.classList.contains("selected"))
        {
            select_all_to_completed.innerText = "Снять выбор";
            select_all_to_completed.classList.remove("btn-outline-primary");
            select_all_to_completed.classList.add("btn-primary");
        }
    else

       {
           select_all_to_completed.innerText = "Выбрать все";
           select_all_to_completed.classList.add("btn-outline-primary");
           select_all_to_completed.classList.remove("btn-primary");
       }


    const orders = document.querySelectorAll(".add-all-to-completed");

    // Выбрать все НЕ disabled (т.е. те, которые не на производстве)
    orders.forEach(checkbox => {if (!checkbox.disabled) { checkbox.checked = select_all_to_completed.classList.contains("selected");} } );

    const checkboxes = document.querySelectorAll(".add-all-to-completed");
    const atLeastOneChecked = Array.from(checkboxes).some(cb => cb.checked);

    if (atLeastOneChecked) {
        add_all_to_completed.classList.remove("d-none");
    }
    else {
        add_all_to_completed.classList.add("d-none");
    }

});

var checkboxs_all_to_completed = document.querySelectorAll(".add-all-to-completed");

/** Скрыть или показать кнопку "Добавить выбранные" */
for (checkbox_all_to_completed of checkboxs_all_to_completed) {

    checkbox_all_to_completed?.addEventListener("click", function() {

        const checkboxes = document.querySelectorAll(".add-all-to-completed");
        const atLeastOneChecked = Array.from(checkboxes).some(cb => cb.checked);

        if (atLeastOneChecked) {
           add_all_to_completed.classList.remove("d-none");
        }
        else {
            add_all_to_completed.classList.add("d-none");
        }

    });
}
 </script>


{% endblock %}

